import{_ as e,o as s,c as t,a as n}from"./app.57a3dbd1.js";const m=JSON.parse('{"title":"Front-end and back-end deployment","description":"","frontmatter":{"contributors":["ZhouYixun","soniclei"]},"headers":[{"level":2,"title":"Quick deploy","slug":"quick-deploy","link":"#quick-deploy","children":[]},{"level":2,"title":".env configuration item description","slug":"env-configuration-item-description","link":"#env-configuration-item-description","children":[]},{"level":2,"title":"Use your own Eureka","slug":"use-your-own-eureka","link":"#use-your-own-eureka","children":[]},{"level":2,"title":"Built-in MySQL in docker-compose.ymlÔºàNot recommendedÔºâ","slug":"built-in-mysql-in-docker-compose-yml-not-recommended","link":"#built-in-mysql-in-docker-compose-yml-not-recommended","children":[]},{"level":2,"title":"Frequently Asked QuestionsÔºàQ&AÔºâ","slug":"frequently-asked-questions-q-a","link":"#frequently-asked-questions-q-a","children":[]}],"relativePath":"en/deploy/back-end-deploy.md","lastUpdated":1716537034000}'),o={name:"en/deploy/back-end-deploy.md"},a=n(`<h1 id="front-end-and-back-end-deployment" tabindex="-1">Front-end and back-end deployment <a class="header-anchor" href="#front-end-and-back-end-deployment" aria-hidden="true">#</a></h1><p>This article shows you how to deploy the Server and Client sides of Sonic.</p><h2 id="quick-deploy" tabindex="-1">Quick deploy <a class="header-anchor" href="#quick-deploy" aria-hidden="true">#</a></h2><p>In this mode, the front and back ends are deployed at one time.</p><p>preparatory work: docker-compose, Docker, MySQL</p><ol><li>Create a MySQL database. The database name can be customized. Note that the character set is utf8 and the collation rule is utf8_general_ci. If you want MySQL to start with Sonic (not recommended), refer to the <code>Built-in MySQL in docker-compose.yml</code> section at the bottom of this page.</li><li><a href="https://ghproxy.com/https://github.com/SonicCloudOrg/sonic-server/releases/download/v2.6.4/sonic-server-v2.6.4.zip" target="_blank" rel="noreferrer">Click here</a> Download the latest version of the <strong>zip</strong> file to any directory. (If the accelerator link fails, please go by yourself <a href="https://github.com/SonicCloudOrg/sonic-server/releases" target="_black">here</a> download)</li><li>Unzip and change the information in.env. Do not modify docker-compose.yml file. For details about the env configuration item, see the following table. If your system does not display.env, see the solution at the bottom of the page under FAQs)</li><li>Run the following command in the current directory</li></ol><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker-compose</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">up</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">If you are a user in mainland China and DockerHub access is slow, you can choose one of the following two points for operation:</p><ul><li>Configuring a Domestic accelerated Mirror Source (Recommended)</li><li>Run the following command to directly use the accelerator mirror (not recommended, because the accelerator source may be unstable or the network fluctuates. This command is required in the down state <code>docker-compose -f docker-compose-zh.yml</code> downÔºâ</li></ul><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">docker-compose</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-f</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">docker-compose-zh.yml</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">up</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-d</span></span>
<span class="line"></span></code></pre></div></div><ol start="5"><li>The front and rear ends are deployed!(Due to the Eureka heartbeat mechanism, it takes 3 to 5 minutes for microservices to access each other. Please wait patiently)Open a browser and visit <a href="http://localhost:3000" target="_blank" rel="noreferrer">http://localhost:3000</a>ÔºåThen you can <strong>directly deploy</strong> the Agent„ÄÇ</li><li>(Attached) If you are experienced operation and maintenance personnel, you can also visit the Eureka page to check the status of each micro-service.</li></ol><h2 id="env-configuration-item-description" tabindex="-1">.env configuration item description <a class="header-anchor" href="#env-configuration-item-description" aria-hidden="true">#</a></h2><table><thead><tr><th>params</th><th>description</th><th>example</th></tr></thead><tbody><tr><td>SONIC_SERVER_HOST</td><td>localhost or 127.0.0.1 cannot be used as the ipv4 address of the machine where the sonic-server is deployed. <strong>can use domain names.</strong></td><td>192.168.0.1</td></tr><tr><td>SONIC_SERVER_PORT</td><td>The whole server is exposed to external ports. The default port is 3000. <strong>can use 80</strong></td><td>3000</td></tr><tr><td>SONIC_EUREKA_USERNAME</td><td>User name for Eureka (For security purposes, the default value is not recommended, but can be changed to any other string, excluding <code>@</code> and <code>%</code>)</td><td>sonic</td></tr><tr><td>SONIC_EUREKA_PASSWORD</td><td>Eureka password (For security purposes, the default value is not recommended. You can change it to any other string, excluding <code>@</code> and <code>%</code>)</td><td>sonic</td></tr><tr><td>SONIC_EUREKA_PORT</td><td>Eureka start port (usually no change is requiredÔºâ</td><td>9090</td></tr><tr><td>MYSQL_HOST</td><td>The host of the MySQL service cannot be localhost or 127.0.0.1.</td><td>192.168.0.1</td></tr><tr><td>MYSQL_PORT</td><td>MySQL service port (default 3306Ôºâ</td><td>3306</td></tr><tr><td>MYSQL_DATABASE</td><td>Data to be used by the Sonic service</td><td>sonic</td></tr><tr><td>MYSQL_USERNAME</td><td>MySQL database user name</td><td>root</td></tr><tr><td>MYSQL_PASSWORD</td><td>MySQL password</td><td>Sonic!Hello</td></tr><tr><td>SECRET_KEY</td><td>Token secret keyÔºàTo improve security, it is not recommended to use the default value, which can be changed to any other stringÔºâ</td><td>sonic</td></tr><tr><td>EXPIRE_DAY</td><td>Token expire day</td><td>14</td></tr><tr><td>PERMISSION_ENABLE</td><td>Enable permission module</td><td>true</td></tr><tr><td>PERMISSION_SUPER_ADMIN</td><td>Super admin user name</td><td>sonic</td></tr><tr><td>REGISTER_ENABLE</td><td>Enable register module</td><td>true</td></tr><tr><td>NORMAL_USER_ENABLE</td><td>Enable normal user login</td><td>true</td></tr><tr><td>LDAP_USER_ENABLE</td><td>Enable LDAP user login</td><td>true</td></tr><tr><td>LDAP_USER_ID</td><td>LDAP user id search</td><td>cn</td></tr><tr><td>LDAP_BASE_DN</td><td>LDAP user base dn</td><td>users</td></tr><tr><td>LDAP_BASE</td><td>LDAP Base DN</td><td>ou=system</td></tr><tr><td>LDAP_USERNAME</td><td>LDAP Base DN admin username</td><td>uid=admin,ou=system</td></tr><tr><td>LDAP_PASSWORD</td><td>LDAP Base DN admin pwd</td><td>Sonic!@#123</td></tr><tr><td>LDAP_URL</td><td>LDAP service URL</td><td>ldap://192.168.0.1:10389</td></tr><tr><td>LDAP_OBJECT_CLASS</td><td>LDAP filter class, default person</td><td>person</td></tr></tbody></table><h2 id="use-your-own-eureka" tabindex="-1">Use your own Eureka <a class="header-anchor" href="#use-your-own-eureka" aria-hidden="true">#</a></h2><p>If you have your own Eureka service, you can view this section.</p><ol><li>Remove Eureka service from <strong>docker-compose.yml</strong> .</li><li>Replace SONIC_EUREKA_HOST to your own Eureka service from <strong>docker-compose.yml</strong> .</li><li>Replace your own Eureka service info form .env .</li><li>Done!</li></ol><h2 id="built-in-mysql-in-docker-compose-yml-not-recommended" tabindex="-1">Built-in MySQL in docker-compose.ymlÔºàNot recommendedÔºâ <a class="header-anchor" href="#built-in-mysql-in-docker-compose-yml-not-recommended" aria-hidden="true">#</a></h2><p>Because MySQL is prone to data loss due to improper operation or data migration risks during Docker mounting, so docker-compose.yml does not come with a MySQL image by default.</p><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>This method is not necessarily compatible with all Docker versions, Linux systems and Mysql versions, and the current data should be backed up before operation. Moreover, the MySQL container will be stopped and deleted during the update, so it is recommended to deploy MySQL alone or use the existing MySQL service.</p></div><p>If you want MySQL to start with sonic, you can do the following:</p><ol><li>Create the <code>mysql</code> folder in the current directory</li></ol><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#FFCB6B;">mkdir</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-p</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql/log</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql/data</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">mysql/conf</span></span>
<span class="line"></span></code></pre></div><ol start="2"><li>Change <code>MYSQL_HOST</code> in .env to <code>sonic-mysql</code></li><li>Add the following <strong>comment section</strong> to docker-compose.yml</li></ol><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">version: &#39;3&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">services:</span></span>
<span class="line"><span style="color:#A6ACCD;">  sonic-server-eureka:</span></span>
<span class="line"><span style="color:#A6ACCD;">  .</span></span>
<span class="line"><span style="color:#A6ACCD;">  .</span></span>
<span class="line"><span style="color:#A6ACCD;">  .</span></span>
<span class="line"><span style="color:#A6ACCD;">  .</span></span>
<span class="line"><span style="color:#A6ACCD;">  .</span></span>
<span class="line"><span style="color:#A6ACCD;">  sonic-client-web:</span></span>
<span class="line"><span style="color:#A6ACCD;">    image: &quot;sonicorg/sonic-client-web:SONIC_VERSION&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    environment:</span></span>
<span class="line"><span style="color:#A6ACCD;">      - SONIC_SERVER_HOST</span></span>
<span class="line"><span style="color:#A6ACCD;">      - SONIC_SERVER_PORT</span></span>
<span class="line"><span style="color:#A6ACCD;">    networks:</span></span>
<span class="line"><span style="color:#A6ACCD;">      - sonic-network</span></span>
<span class="line"><span style="color:#A6ACCD;">    depends_on:</span></span>
<span class="line"><span style="color:#A6ACCD;">      - sonic-server-gateway</span></span>
<span class="line"><span style="color:#A6ACCD;">    restart: on-failure</span></span>
<span class="line"><span style="color:#A6ACCD;">    ports:</span></span>
<span class="line"><span style="color:#A6ACCD;">      - &quot;\${SONIC_SERVER_PORT}:80&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"># ==== MySQL ====</span></span>
<span class="line"><span style="color:#A6ACCD;">  sonic-mysql:</span></span>
<span class="line"><span style="color:#A6ACCD;">    image: &quot;mysql:5.7&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    hostname: sonic-mysql</span></span>
<span class="line"><span style="color:#A6ACCD;">    command: mysqld --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci</span></span>
<span class="line"><span style="color:#A6ACCD;">    environment:</span></span>
<span class="line"><span style="color:#A6ACCD;">      - MYSQL_ROOT_PASSWORD=\${MYSQL_PASSWORD}</span></span>
<span class="line"><span style="color:#A6ACCD;">      - MYSQL_DATABASE</span></span>
<span class="line"><span style="color:#A6ACCD;">    volumes:</span></span>
<span class="line"><span style="color:#A6ACCD;">      - ./mysql/log:/var/log/mysql</span></span>
<span class="line"><span style="color:#A6ACCD;">      - ./mysql/data:/var/lib/mysql</span></span>
<span class="line"><span style="color:#A6ACCD;">      - ./mysql/conf:/etc/mysql</span></span>
<span class="line"><span style="color:#A6ACCD;">    ports:</span></span>
<span class="line"><span style="color:#A6ACCD;">      - &quot;3306:3306&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    networks:</span></span>
<span class="line"><span style="color:#A6ACCD;">      - sonic-network</span></span>
<span class="line"><span style="color:#A6ACCD;"># ==== End ====</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">networks:</span></span>
<span class="line"><span style="color:#A6ACCD;">  sonic-network:</span></span>
<span class="line"><span style="color:#A6ACCD;">    driver: bridge</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><ol start="4"><li>Just execute <code>docker-compose up -d</code>.</li></ol><h2 id="frequently-asked-questions-q-a" tabindex="-1">Frequently Asked QuestionsÔºàQ&amp;AÔºâ <a class="header-anchor" href="#frequently-asked-questions-q-a" aria-hidden="true">#</a></h2><p>Q1: The browser accesses the front end without errors, but „Äêsystem error„Äë or „Äêunknown exception occurred„Äë appears during registration.</p><p>A1: The solution can refer to <a href="https://sonic-cloud.wiki/d/35-sonic" target="_blank" rel="noreferrer">this post</a></p><hr><p>Q2: Check the log and find that MySQL is not connected, how to solve it?</p><p>A2: Mainly divided into a variety of situations:</p><ul><li>MySQL does not have remote access permissions enabled.</li><li>Due to the deployment of Docker containers, ip addresses such as 127.0.0.1 or localhost are invalid.</li><li>Special circumstances such as corporate network restrictions.</li></ul><p>The solution can refer to <a href="https://sonic-cloud.wiki/d/33-mysql" target="_blank" rel="noreferrer">this post</a>.</p><hr><p>Q3: At present, the files are mounted in the default directory of Docker, how can they be mounted to a custom file directory?</p><p>A3: The solution can refer to <a href="https://sonic-cloud.wiki/d/120-sonic" target="_blank" rel="noreferrer">this post</a>.</p><hr><p>Q4: The Mac system does not see the .env file after decompression, how to solve it?</p><p>A4: The solution can refer to <a href="https://sonic-cloud.wiki/d/707-mac" target="_blank" rel="noreferrer">this post</a></p><hr><p>Q5: I don&#39;t see the .env file after decompressing the Linux system, how to solve it?</p><p>A5: You can use the ls -a command to view hidden files</p><hr><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>For more questions, please go to üëâ<a href="https://discord.gg/c9ZD6jSyTE" target="_blank" rel="noreferrer">Community</a>üëà to communicate</p></div>`,42),r=[a];function l(i,c,d,p,u,h){return s(),t("div",null,r)}const A=e(o,[["render",l]]);export{m as __pageData,A as default};
