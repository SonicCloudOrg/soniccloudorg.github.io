import{_ as s,o as a,c as n,a as l}from"./app.57a3dbd1.js";const A=JSON.parse('{"title":"custom script","description":"","frontmatter":{"contributors":["ZhouYixun","mmagi"]},"headers":[{"level":2,"title":"1. Groovy (Java) script (recommended ðŸ”¥)","slug":"_1-groovy-java-script-recommended-ðŸ”¥","link":"#_1-groovy-java-script-recommended-ðŸ”¥","children":[{"level":3,"title":"Ability Introduction","slug":"ability-introduction","link":"#ability-introduction","children":[]},{"level":3,"title":"Output log to test report","slug":"output-log-to-test-report","link":"#output-log-to-test-report","children":[]},{"level":3,"title":"Reference global parameters","slug":"reference-global-parameters","link":"#reference-global-parameters","children":[]},{"level":3,"title":"Get device serial number","slug":"get-device-serial-number","link":"#get-device-serial-number","children":[]},{"level":3,"title":"Assertions","slug":"assertions","link":"#assertions","children":[]},{"level":3,"title":"Exit Driver","slug":"exit-driver","link":"#exit-driver","children":[]},{"level":3,"title":"Sample script display","slug":"sample-script-display","link":"#sample-script-display","children":[]}]},{"level":2,"title":"2. Python script","slug":"_2-python-script","link":"#_2-python-script","children":[{"level":3,"title":"Ability Introduction","slug":"ability-introduction-1","link":"#ability-introduction-1","children":[]},{"level":3,"title":"Pre-environment","slug":"pre-environment","link":"#pre-environment","children":[]},{"level":3,"title":"Available parameters","slug":"available-parameters","link":"#available-parameters","children":[]},{"level":3,"title":"Exit Driver","slug":"exit-driver-1","link":"#exit-driver-1","children":[]},{"level":3,"title":"Sample script display","slug":"sample-script-display-1","link":"#sample-script-display-1","children":[]}]},{"level":2,"title":"Import template","slug":"import-template","link":"#import-template","children":[]},{"level":2,"title":"Usage Specifications and Suggestions","slug":"usage-specifications-and-suggestions","link":"#usage-specifications-and-suggestions","children":[]}],"relativePath":"en/doc/doc-script.md","lastUpdated":1716537034000}'),o={name:"en/doc/doc-script.md"},p=l(`<h1 id="custom-script" tabindex="-1">custom script <a class="header-anchor" href="#custom-script" aria-hidden="true">#</a></h1><p>Use custom scripts to perform UI automation. (This function needs to be upgraded to Sonic v2.0.0 version)</p><h2 id="_1-groovy-java-script-recommended-ðŸ”¥" tabindex="-1">1. Groovy (Java) script (recommended ðŸ”¥) <a class="header-anchor" href="#_1-groovy-java-script-recommended-ðŸ”¥" aria-hidden="true">#</a></h2><h3 id="ability-introduction" tabindex="-1">Ability Introduction <a class="header-anchor" href="#ability-introduction" aria-hidden="true">#</a></h3><div class="tip custom-block"><p class="custom-block-title">Sonic official recommendation reason</p><ol><li>You can directly use all built-in functions and variables of Agent.</li><li>The Groovy engine is compatible with the Java language and can be well combined with Java. It can directly run Java code or mix Groovy and Java.</li><li>Groovy has a simple syntax, is easy to expand, and has a low learning threshold.</li><li>Run directly on the JVM, no need to configure additional environment.</li><li>Wait...</li></ol></div><h4 id="default-built-in-content" tabindex="-1">Default built-in content <a class="header-anchor" href="#default-built-in-content" aria-hidden="true">#</a></h4><p>Before executing custom scripts, the basic StepHandler is passed to the Groovy engine.</p><p>including but not limited to:</p><ol><li>The log object, which can manipulate the output text of the test report</li><li>androidDriver, can operate UIAutomator2-Server</li><li>iosDriver, can operate Wda</li><li>Global parameters, you can access the global parameters</li><li>Sonic&#39;s custom steps can be reused directly</li><li>Others, including PocoDriver, device information, etc.</li></ol><div class="tip custom-block"><p class="custom-block-title">More built-in methods can be viewed</p><p><a href="https://github.com/SonicCloudOrg/sonic-agent/blob/main/src/main/java/org/cloud/sonic/agent/tests/handlers/AndroidStepHandler.java" target="_blank" rel="noreferrer">AndroidStepHandler</a></p><p><a href="https://github.com/SonicCloudOrg/sonic-agent/blob/main/src/main/java/org/cloud/sonic/agent/tests/handlers/IOSSstepHandler.java" target="_blank" rel="noreferrer">IOSSstepHandler</a></p></div><h4 id="extendability" tabindex="-1">Extendability <a class="header-anchor" href="#extendability" aria-hidden="true">#</a></h4><p>Capabilities other than StepHandler can be implemented by directly importing the corresponding package or directly referencing it.</p><p>including but not limited to:</p><ol><li>RestTemaplate, which can perform Rest Api operations.</li><li>Java&#39;s built-in Process can run local instructions.</li><li>SibTool, a tool class for using sib.</li><li>AndroidDeviceBridgeTool, which is used to operate some tool classes of adb.</li><li>fastJson and other packages and so on.</li></ol><h3 id="output-log-to-test-report" tabindex="-1">Output log to test report <a class="header-anchor" href="#output-log-to-test-report" aria-hidden="true">#</a></h3><p>Manipulate <strong>androidStepHandler.log</strong> directly using</p><div class="language-groovy"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sendStepLog</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">I am a general log</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Step detailed log</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sendStepLog</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">2</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">I passed the log</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Step detailed log</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sendStepLog</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">3</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">I am an alarm log</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Step detailed log</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sendStepLog</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">4</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">I am an exception log</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Step detailed log</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>The input parameters are: <strong>log level</strong>, <strong>step description</strong>, <strong>step detailed log</strong></p><p>There are four log levels, from 1-4: INFO, PASS, WARN, ERROR</p><p>It is also possible to extract LogUtil and StepType usage to make scripts more readable</p><div class="language-groovy"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">cloud</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sonic</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">agent</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">tests</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">LogUtil</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">cloud</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sonic</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">agent</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">common</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">interfaces</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">StepType</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">test</span><span style="color:#A6ACCD;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#C792EA;">LogUtil</span><span style="color:#A6ACCD;"> log </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log</span></span>
<span class="line"><span style="color:#A6ACCD;">   log</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sendStepLog</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">StepType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">INFO</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">world</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">   log</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sendStepLog</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">StepType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">PASS</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">world</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">   log</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sendStepLog</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">StepType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">WARN</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">world</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">   log</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sendStepLog</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">StepType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ERROR</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">world</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">test</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><h3 id="reference-global-parameters" tabindex="-1">Reference global parameters <a class="header-anchor" href="#reference-global-parameters" aria-hidden="true">#</a></h3><p>Global parameters are stored in androidStepHandler.globalParams by default, which is a com.alibaba.fastjson.JSONObject object. can be used directly</p><div class="language-groovy"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> test </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">globalParams</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">getString</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sendStepLog</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Get the global parameter Hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Value: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> test</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>For more global parameters and temporary parameters, please refer to <a href="https://sonic-cloud.wiki/d/2369" target="_blank" rel="noreferrer">this post</a></p></div><h3 id="get-device-serial-number" tabindex="-1">Get device serial number <a class="header-anchor" href="#get-device-serial-number" aria-hidden="true">#</a></h3><p>Android:</p><div class="language-groovy"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> udId </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">iDevice</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">getSerialNumber</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sendStepLog</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Get udId</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Value: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> udId</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><p>iOS:</p><div class="language-groovy"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> udId </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> iosStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">udId</span></span>
<span class="line"><span style="color:#A6ACCD;">iosStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sendStepLog</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Get udId</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Value: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;"> udId</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><h3 id="assertions" tabindex="-1">Assertions <a class="header-anchor" href="#assertions" aria-hidden="true">#</a></h3><p>There are assertEquals, assertNotEquals, assertNull, assertNotNull and other methods that can be used directly</p><div class="language-groovy"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">import static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">testng</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">Assert</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">*;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">assertEquals</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1+1</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>Assertion failures throw exceptions and custom script steps are marked as failed</p><h3 id="exit-driver" tabindex="-1">Exit Driver <a class="header-anchor" href="#exit-driver" aria-hidden="true">#</a></h3><p>If there is an instrument-based framework (such as fastbot, uiautomator2-python, poco-service, etc.) in your third-party tools, it will conflict with Sonic&#39;s existing processes and cause a blocking state. At this time, we can stop Sonic&#39;s Driver first.</p><h4 id="android" tabindex="-1">Android: <a class="header-anchor" href="#android" aria-hidden="true">#</a></h4><p>There are two ways to close AndroidDriver:</p><ol><li>Close with built-in function (recommended)</li></ol><div class="language-groovy"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">cloud</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sonic</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">agent</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">bridge</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">AndroidDeviceBridgeTool</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//Stop Driver</span></span>
<span class="line"><span style="color:#A6ACCD;">androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">getAndroidDriver</span><span style="color:#89DDFF;">().</span><span style="color:#A6ACCD;">closeDriver</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//Third party operation</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//xxxxxx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//Restart Driver</span></span>
<span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> port </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">AndroidDeviceBridgeTool</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">startUiaServer</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">iDevice</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">startAndroidDriver</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">iDevice</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> port</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><ol start="2"><li>Use adb to forcibly stop the instrument service (not recommended)</li></ol><div class="language-groovy"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">cloud</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sonic</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">agent</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">bridge</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">AndroidDeviceBridgeTool</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//Stop UIAutomator2-server</span></span>
<span class="line"><span style="color:#C792EA;">AndroidDeviceBridgeTool</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">executeCommand</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">iDevice</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">am force-stop io.appium.uiautomator2.server</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#C792EA;">AndroidDeviceBridgeTool</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">executeCommand</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">iDevice</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">am force-stop io.appium.uiautomator2.server.test</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//Third party operation</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//xxxxxx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//Restart Driver</span></span>
<span class="line"><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> port </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">AndroidDeviceBridgeTool</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">startUiaServer</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">iDevice</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">startAndroidDriver</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">iDevice</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> port</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><h4 id="ios" tabindex="-1">iOS: <a class="header-anchor" href="#ios" aria-hidden="true">#</a></h4><div class="language-groovy"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">cloud</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sonic</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">agent</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">bridge</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">ios</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">SibTool</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//Stop Driver</span></span>
<span class="line"><span style="color:#A6ACCD;">iosStepHandler. closeIOSDriver</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//Third party operation</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//xxxxxx</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">//Restart Driver</span></span>
<span class="line"><span style="color:#A6ACCD;">iosStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">startIOSDriver</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">udId</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">SibTool</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">startWda</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">udId</span><span style="color:#89DDFF;">)[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">])</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span></code></pre></div><h3 id="sample-script-display" tabindex="-1">Sample script display <a class="header-anchor" href="#sample-script-display" aria-hidden="true">#</a></h3><h4 id="call-third-party-rest-api" tabindex="-1">Call third-party Rest API <a class="header-anchor" href="#call-third-party-rest-api" aria-hidden="true">#</a></h4><p>The following is an example of asserting the response result and outputting it to the test report after using the RestTemplate to call the third-party Rest API.</p><div class="language-groovy"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">com</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">alibaba</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">fastjson</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">JSONObject</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">springframework</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">http</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">HttpEntity</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">springframework</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">http</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">HttpHeaders</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">springframework</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">http</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">HttpMethod</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">cloud</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sonic</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">agent</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">tools</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">SpringTool</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">springframework</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">web</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">client</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">RestTemplate</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">cloud</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sonic</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">agent</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">tests</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">LogUtil</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">cloud</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sonic</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">agent</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">common</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">interfaces</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">StepType</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">import static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">testng</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">Assert</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">*;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">testRestApi</span><span style="color:#A6ACCD;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">LogUtil</span><span style="color:#A6ACCD;"> log </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">RestTemplate</span><span style="color:#A6ACCD;"> restTemplate </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">SpringTool</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">getBean</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">RestTemplate</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">class</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">HttpHeaders</span><span style="color:#A6ACCD;"> headers </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">HttpHeaders</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">       headers</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">add</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">SonicToken</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">xxxxxxx</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#C792EA;">JSONObject</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> restTemplate</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">exchange</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://localhost:8094/api/controller/projects/list</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">HttpMethod</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">GET</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">HttpEntity&lt;&gt;</span><span style="color:#A6ACCD;">(headers)</span><span style="color:#89DDFF;">,</span><span style="color:#C792EA;">JSONObject</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">class</span><span style="color:#89DDFF;">).</span><span style="color:#A6ACCD;">getBody</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#82AAFF;">assertEquals</span><span style="color:#A6ACCD;">(result. getInteger</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">code</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">2000</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">       log</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sendStepLog</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">StepType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">INFO</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">rest api assert</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">result: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">toJSONString</span><span style="color:#89DDFF;">())</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">testRestApi</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><h4 id="adb-shell-operation" tabindex="-1">adb shell operation <a class="header-anchor" href="#adb-shell-operation" aria-hidden="true">#</a></h4><p>The following is an example of the output of the adb shell command, including one-time output and continuous output.</p><div class="language-groovy"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">cloud</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sonic</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">agent</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">bridge</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">AndroidDeviceBridgeTool</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">cloud</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sonic</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">agent</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">tests</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">LogUtil</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">cloud</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sonic</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">agent</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">common</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">interfaces</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">StepType</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">com</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">ddmlib</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">IShellOutputReceiver</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">java</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">util</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">concurrent</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">TimeUnit</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">test</span><span style="color:#A6ACCD;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#C792EA;">LogUtil</span><span style="color:#A6ACCD;"> log </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> out </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">AndroidDeviceBridgeTool</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">executeCommand</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">iDevice</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">wm size</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">         log</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sendStepLog</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">StepType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">INFO</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Get screen size</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">testLong</span><span style="color:#A6ACCD;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#C792EA;">LogUtil</span><span style="color:#A6ACCD;"> log </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log</span></span>
<span class="line"><span style="color:#A6ACCD;">         androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">iDevice</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">executeShellCommand</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dumpsys window displays</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                         </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">IShellOutputReceiver</span><span style="color:#A6ACCD;">() {</span></span>
<span class="line"><span style="color:#A6ACCD;">                             </span><span style="color:#C792EA;">@Override</span></span>
<span class="line"><span style="color:#A6ACCD;">                             </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">addOutput</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">byte</span><span style="color:#A6ACCD;">[] </span><span style="color:#A6ACCD;font-style:italic;">bytes</span><span style="color:#A6ACCD;">, </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">i</span><span style="color:#A6ACCD;">, </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">i1</span><span style="color:#A6ACCD;">) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                                 </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> res </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;">(bytes, i, i1);</span></span>
<span class="line"><span style="color:#A6ACCD;">                                 log</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sendStepLog</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">StepType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">INFO</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Dump windows msg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                             }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">                             </span><span style="color:#C792EA;">@Override</span></span>
<span class="line"><span style="color:#A6ACCD;">                             </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">flush</span><span style="color:#A6ACCD;">() {</span></span>
<span class="line"><span style="color:#A6ACCD;">                             }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">                             </span><span style="color:#C792EA;">@Override</span></span>
<span class="line"><span style="color:#A6ACCD;">                             </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">isCancelled</span><span style="color:#A6ACCD;">() {</span></span>
<span class="line"><span style="color:#A6ACCD;">                                 </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                             }</span></span>
<span class="line"><span style="color:#A6ACCD;">                         }</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">TimeUnit</span><span style="color:#A6ACCD;">. MILLISECONDS</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">test</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">testLong</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><h4 id="execute-fastbot" tabindex="-1">Execute fastbot <a class="header-anchor" href="#execute-fastbot" aria-hidden="true">#</a></h4><p>The following shows how to execute fastbot and continuously output the log to the test report. Note: Make sure that there are fastbot-related jars on the device before execution. For details, please refer to the fastbot documentation.</p><p>Because the bottom layer of fastbot has a conflict with the instrumentation of uia2 (although Sonic will deal with it later, it is best to avoid conflicts), so execute closeDriver() first, and then startDriver() again after running</p><div class="language-groovy"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">cloud</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sonic</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">agent</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">bridge</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">AndroidDeviceBridgeTool</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">cloud</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sonic</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">agent</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">tests</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">LogUtil</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">cloud</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sonic</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">agent</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">common</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">interfaces</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">StepType</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">com</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">android</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">ddmlib</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">IShellOutputReceiver</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">java</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">util</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">concurrent</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">TimeUnit</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">testFastbot</span><span style="color:#A6ACCD;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#C792EA;">LogUtil</span><span style="color:#A6ACCD;"> log </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log</span></span>
<span class="line"><span style="color:#A6ACCD;">         androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">getAndroidDriver</span><span style="color:#89DDFF;">().</span><span style="color:#A6ACCD;">closeDriver</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">         androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">iDevice</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">executeShellCommand</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">CLASSPATH=/sdcard/monkeyq.jar:/sdcard/framework.jar:/sdcard/fastbot-thirdpart.jar exec app_process /system/bin com.android.commands.monkey.Monkey -p package_name - -agent reuseq --running-minutes duration(min) --throttle delay(ms) -v -v</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">                         </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">IShellOutputReceiver</span><span style="color:#A6ACCD;">() {</span></span>
<span class="line"><span style="color:#A6ACCD;">                             </span><span style="color:#C792EA;">@Override</span></span>
<span class="line"><span style="color:#A6ACCD;">                             </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">addOutput</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">byte</span><span style="color:#A6ACCD;">[] </span><span style="color:#A6ACCD;font-style:italic;">bytes</span><span style="color:#A6ACCD;">, </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">i</span><span style="color:#A6ACCD;">, </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">i1</span><span style="color:#A6ACCD;">) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                                 </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> res </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;">(bytes, i, i1);</span></span>
<span class="line"><span style="color:#A6ACCD;">                                 log</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sendStepLog</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">StepType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">INFO</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">FastBot log</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">res</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                             }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">                             </span><span style="color:#C792EA;">@Override</span></span>
<span class="line"><span style="color:#A6ACCD;">                             </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">void</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">flush</span><span style="color:#A6ACCD;">() {</span></span>
<span class="line"><span style="color:#A6ACCD;">                             }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">                             </span><span style="color:#C792EA;">@Override</span></span>
<span class="line"><span style="color:#A6ACCD;">                             </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">isCancelled</span><span style="color:#A6ACCD;">() {</span></span>
<span class="line"><span style="color:#A6ACCD;">                                 </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">false</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                             }</span></span>
<span class="line"><span style="color:#A6ACCD;">                         }</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">TimeUnit</span><span style="color:#A6ACCD;">. MILLISECONDS</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#C792EA;">int</span><span style="color:#A6ACCD;"> port </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">AndroidDeviceBridgeTool</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">startUiaServer</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">iDevice</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">         androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">startAndroidDriver</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">iDevice</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> port</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">testFastbot</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><h4 id="run-the-local-command-command" tabindex="-1">Run the local command command <a class="header-anchor" href="#run-the-local-command-command" aria-hidden="true">#</a></h4><p>The following is an example of running the Agent&#39;s local PC command and continuously outputting the command result to the test report after running the command.</p><div class="language-groovy"><button title="Copy Code" class="copy"></button><span class="lang">groovy</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">cloud</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sonic</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">agent</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">tests</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">LogUtil</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">org</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">cloud</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">sonic</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">agent</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">common</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">interfaces</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">StepType</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">java</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">io</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">IOException</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">java</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">io</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">InputStreamReader</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F78C6C;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">java</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">io</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">BufferedReader</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">testCmd</span><span style="color:#A6ACCD;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">             </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> system </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">getProperty</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">os.name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">).</span><span style="color:#A6ACCD;">toLowerCase</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">             </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (system. contains</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">win</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                 </span><span style="color:#C792EA;">Runtime</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">getRuntime</span><span style="color:#89DDFF;">().</span><span style="color:#A6ACCD;">exec</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">cmd /c calc</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">             } </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">                 </span><span style="color:#C792EA;">Runtime</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">getRuntime</span><span style="color:#89DDFF;">().</span><span style="color:#A6ACCD;">exec</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sh -c echo Hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">             }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">testCmdForLongTime</span><span style="color:#A6ACCD;">(){</span></span>
<span class="line"><span style="color:#A6ACCD;">             </span><span style="color:#C792EA;">LogUtil</span><span style="color:#A6ACCD;"> log </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> androidStepHandler</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">log</span></span>
<span class="line"><span style="color:#A6ACCD;">             </span><span style="color:#C792EA;">Process</span><span style="color:#A6ACCD;"> ps </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">             </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> system </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">getProperty</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">os.name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">).</span><span style="color:#A6ACCD;">toLowerCase</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">             </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> (system. contains</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">win</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                 ps </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Runtime</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">getRuntime</span><span style="color:#89DDFF;">().</span><span style="color:#A6ACCD;">exec</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">cmd /c calc</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">             } </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">                 ps </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Runtime</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">getRuntime</span><span style="color:#89DDFF;">().</span><span style="color:#A6ACCD;">exec</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sh -c echo Hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">             }</span></span>
<span class="line"><span style="color:#A6ACCD;">             </span><span style="color:#C792EA;">InputStreamReader</span><span style="color:#A6ACCD;"> inputStreamReader </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">InputStreamReader</span><span style="color:#A6ACCD;">(ps. getInputStream</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">             </span><span style="color:#C792EA;">BufferedReader</span><span style="color:#A6ACCD;"> stdInput </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">BufferedReader</span><span style="color:#A6ACCD;">(inputStreamReader);</span></span>
<span class="line"><span style="color:#A6ACCD;">             </span><span style="color:#C792EA;">String</span><span style="color:#A6ACCD;"> s;</span></span>
<span class="line"><span style="color:#A6ACCD;">             </span><span style="color:#89DDFF;font-style:italic;">while</span><span style="color:#A6ACCD;"> (ps. isAlive</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                 </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#A6ACCD;"> {</span></span>
<span class="line"><span style="color:#A6ACCD;">                     </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> ((s </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> stdInput. readLine</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">!=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null</span><span style="color:#A6ACCD;">) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                         log</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">sendStepLog</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">StepType</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">INFO</span><span style="color:#89DDFF;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ps msg</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">s</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">                     }</span></span>
<span class="line"><span style="color:#A6ACCD;">                 } </span><span style="color:#89DDFF;font-style:italic;">catch</span><span style="color:#A6ACCD;"> (</span><span style="color:#C792EA;">IOException</span><span style="color:#A6ACCD;"> e) {</span></span>
<span class="line"><span style="color:#A6ACCD;">                     e</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">printStackTrace</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                 }</span></span>
<span class="line"><span style="color:#A6ACCD;">             }</span></span>
<span class="line"><span style="color:#A6ACCD;">             stdInput. close</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">             inputStreamReader. close</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">testCmd</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">testCmdForLongTime</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">More reference examples</p><p>If you want to refer to more script examples, you can go to <a href="https://sonic-cloud.wiki/t/script" target="_blank">here</a> to view official or user-shared examples!</p></div><h2 id="_2-python-script" tabindex="-1">2. Python script <a class="header-anchor" href="#_2-python-script" aria-hidden="true">#</a></h2><h3 id="ability-introduction-1" tabindex="-1">Ability Introduction <a class="header-anchor" href="#ability-introduction-1" aria-hidden="true">#</a></h3><div class="info custom-block"><p class="custom-block-title">vs Groovy script</p><p>Python cannot be used as the built-in engine of the Agent, so the built-in methods and packages of the Agent cannot be used. Python scripts can only use some of the parameters passed by the Agent, and dependencies need to be installed locally, which greatly reduces flexibility compared with Groovy scripts.</p></div><h3 id="pre-environment" tabindex="-1">Pre-environment <a class="header-anchor" href="#pre-environment" aria-hidden="true">#</a></h3><p>Python environment, pip environment.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Note! If Agent running on Windows system, make sure to set the Python output charset to UTF-8 to avoid garbled output from scripts. Execute</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#82AAFF;">set</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">PYTHONIOENCODING=UTF-</span><span style="color:#F78C6C;">8</span></span>
<span class="line"></span></code></pre></div><p>to set an environment variable for the Python before starting the Agent.</p></div><h3 id="available-parameters" tabindex="-1">Available parameters <a class="header-anchor" href="#available-parameters" aria-hidden="true">#</a></h3><p>Regardless of Android or iOS, Sonic will pass four parameters to the Python script, arg depends on times are:</p><ol><li>sessionId. Android is the sessionId of uia2, and iOS is the sessionId of wda.</li><li>Device udId.</li><li>Global parameter Json string.</li><li>Remote URL address (available after v2.5.3 update)</li></ol><h3 id="exit-driver-1" tabindex="-1">Exit Driver <a class="header-anchor" href="#exit-driver-1" aria-hidden="true">#</a></h3><p>If there is an instrument-based framework (such as fastbot, uiautomator2-python, poco-service, etc.) in your third-party tools, it will conflict with Sonic&#39;s existing processes and cause a blocking state. At this time, we can stop Sonic&#39;s Driver first.</p><p>####Android:</p><p>Use adb to force stop the instrument service</p><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> os</span></span>
<span class="line"><span style="color:#A6ACCD;">udId </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> sys</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">argv</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">:][</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#A6ACCD;">os</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">system</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">adb -s </span><span style="color:#F78C6C;">{udId}</span><span style="color:#C3E88D;"> shell am force-stop io.appium.uiautomator2.server</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">format</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">udId</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">os</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">system</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">adb -s </span><span style="color:#F78C6C;">{udId}</span><span style="color:#C3E88D;"> am force-stop io.appium.uiautomator2.server.test</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">format</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">udId</span><span style="color:#89DDFF;">))</span></span>
<span class="line"></span></code></pre></div><h3 id="sample-script-display-1" tabindex="-1">Sample script display <a class="header-anchor" href="#sample-script-display-1" aria-hidden="true">#</a></h3><h4 id="test-directly-with-sonic-s-already-started-appium-uiautomator2-server" tabindex="-1">Test directly with Sonic&#39;s already started appium uiautomator2 server <a class="header-anchor" href="#test-directly-with-sonic-s-already-started-appium-uiautomator2-server" aria-hidden="true">#</a></h4><p>The following is an example script for testing directly with Sonic&#39;s already started appium uiautomator2 server.</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#A6ACCD;">pip install -U sonic-uia2-client</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span></code></pre></div><div class="language-python"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki material-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> sys</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> os</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> common</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">models </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> AndroidSelector</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> uia2</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">driver </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> AndroidDriver</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">test_demo</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">adb_serial_num</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">uia_url</span><span style="color:#89DDFF;">:</span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">    package_name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">com.android.settings</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># Launch App</span></span>
<span class="line"><span style="color:#A6ACCD;">    os</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">system</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">        </span><span style="color:#C792EA;">f</span><span style="color:#C3E88D;">&quot;adb -s </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">adb_serial_num</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;"> shell monkey -p </span><span style="color:#F78C6C;">{</span><span style="color:#82AAFF;">package_name</span><span style="color:#F78C6C;">}</span><span style="color:#C3E88D;"> -c android.intent.category.LAUNCHER 1&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># Connect to uia2 server</span></span>
<span class="line"><span style="color:#A6ACCD;">    driver </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">AndroidDriver</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">uia_url</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    p </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> driver</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get_page_source</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">p</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    e </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> driver</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">find_element</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">AndroidSelector</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">XPATH</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">//*[@text=&#39;è®¾ç½®&#39;]</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> e </span><span style="color:#89DDFF;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">not</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">None:</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get_text</span><span style="color:#89DDFF;">())</span></span>
<span class="line"><span style="color:#A6ACCD;">        e</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">send_keys</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hello</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> __name__ </span><span style="color:#89DDFF;">==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">__main__</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># uia_url available after v2.5.3 update</span></span>
<span class="line"><span style="color:#A6ACCD;">    session_id</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> adb_serial_num</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> global_pramas</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> uia_url </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> sys</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">argv</span><span style="color:#89DDFF;">[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">:]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">session_id</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> adb_serial_num</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> global_pramas</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> uia_url</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">test_demo</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">adb_serial_num</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> uia_url</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">More reference examples</p><p>If you want to refer to more script examples, you can go to <a href="https://sonic-cloud.wiki/t/script" target="_blank">here</a> to view official or user-shared examples!</p></div><h2 id="import-template" tabindex="-1">Import template <a class="header-anchor" href="#import-template" aria-hidden="true">#</a></h2><p>The script templates managed on the [Script Template] page can be imported and used during editing. There are two import modes:</p><ol><li>Append, append the template to the current editing script</li><li>Replace, replace the current editing script with the template</li></ol><h2 id="usage-specifications-and-suggestions" tabindex="-1">Usage Specifications and Suggestions <a class="header-anchor" href="#usage-specifications-and-suggestions" aria-hidden="true">#</a></h2><p>In order to reduce maintenance costs during use, the Sonic organization recommends script management as follows:</p><ol><li>Save common methods/functions to ã€Script Module Managementã€‘.</li><li>When using the script, use the import module to append the method/function to the current script and reference it.</li><li>It is recommended to extract and maintain repeatedly referenced parameters and methods.</li></ol>`,85),e=[p];function t(r,c,D,y,i,C){return a(),n("div",null,e)}const d=s(o,[["render",t]]);export{A as __pageData,d as default};
